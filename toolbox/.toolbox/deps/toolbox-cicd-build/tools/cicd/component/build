#!/usr/bin/env variant
# vi: ft=yaml

parameters:
- name: build
  type: string
  default: |
    git rev-parse --short HEAD > REVISION;

tasks:
  core:
    import: toolbox/.toolbox/deps/toolbox/variant-lib/utils.yaml
  utils:
    tasks:
      build:
        import: toolbox/.toolbox/deps/toolbox-cicd-build/variant-lib/utils.yaml

  staging:
    parameters:
    - name: utils.build.repo
      type: string
      description: Current repo address
    steps:
    - task: utils.build.deliverables
      arguments:
        repo: "{{ .utils.build.repo }}"
        source_branch: master
        target_branch: deliverables_staging
        build_cmd: "{{ .build }}"
